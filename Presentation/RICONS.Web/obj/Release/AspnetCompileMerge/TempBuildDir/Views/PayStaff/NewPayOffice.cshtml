@model RICONS.Web.Models.PhongBanModels
@{
    ViewBag.Title = "Thêm mới trả nhân sự";
}
@*--css--*@
@section CSS
{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~")themes/RICONS-2015/css/controller/PayStaff/NewPayOffice.css" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~")themes/RICONS-2015/css/chosen/chosen.css" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~")themes/RICONS-2015/css/chosen/prism.css" />
}

@*--javascript--*@
@section JavaScript
{
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/controllers/PayStaff/NewPayOffice.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/jquery-ui-1.10.0.custom.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/jquery.datepick-vi.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/chosen/chosen.jquery.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/chosen/prism.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/table/buildTable.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/colResizale/colResizable-1.3.source.js"></script>
    <script type="text/javascript" src="@Url.Content("~")Themes/RICONS-2015/css/TableBuild/global/plugins/jquery.blockui.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")Themes/RICONS-2015/css/TableBuild/global/scripts/app.min.js"></script>

    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/bootbox.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/custom.js"></script>

    <script src="~/Scripts/jquery-2.1.0.intellisense.js"></script>
    <script src="~/Scripts/jquery-2.1.0.js"></script>
    <script src="~/Scripts/jquery-2.1.0.min.js"></script>

}
<script>
    var linkContent = '@Url.Content("~")';
</script>


<div class="HeaderFixed">
    <div class="b-b b-light">
        <div class="p-left c-black">Thông tin chuyển trả nhân sự @Model.tenphongban &nbsp;&nbsp;&nbsp;</div>
        <div class="clearBoth"></div>
    </div>
</div>


<div class="boxEdit">
    @using (Html.BeginForm("NewPayOffice", "PayStaff", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post))
    {
        <div class="row">
            <div class="col-md-2" style="width:170px;"></div>
            <div class="col-md-1"><label style="color:red" id="lblthongbao" class="hidden"></label></div>
            <div class="col-md-1" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" class="hidden" id="txtmatranhansu" name="matranhansu" value="@Model.xoa" /></div>
            <div class="col-md-1" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" class="hidden" id="txtmabosungnhansu" name="mabosungnhansu" /></div>
        </div>
        
          <div class="row">
        <div class="col-md-12" style="font-size: 14px; border-radius: 5px; font-weight: bold; color: black; padding-left: 10px; height: 28px; line-height:26px; background-color:0090d9">I. Phòng ban đề xuất</div>
        </div>
        
        <div class="row">
            <div class="col-md-1" style="min-width: 130px; padding-left: 10px;">Chọn dự án<label style="color:red;height:10px;">*</label>:</div>
            <div class="col-md-3" style="padding-left:10px;">
                <select id="filter01" data-placeholder="" class="chosen-select-loaikehoach" name="mabosungnhansu">
                    <option value="0">Chọn dự án công trường trả nhân sự</option>
                    @if (!string.IsNullOrEmpty(ViewBag.sbpaystaff))
                    {
                        @Html.Raw(ViewBag.sbpaystaff);
                    }
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col-md-1" style="min-width: 130px; padding-left:10px;">Tên dự án<label style="color:red;height:10px;">*</label>:</div>
            <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Tên dự án" id="txttenduan" name="tenduan" /></div>

            <div class="col-md-1" style="min-width: 100px; padding-left:10px;">Số NS hiện tại<label style="color:red;height:10px;">*</label>:</div>
            <div class="col-md-2" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Số nhân sự hiện tại" id="txtsoluongnhansuhientai" name="soluongnhansuhientai" /></div>

            <div class="col-md-1" style="min-width: 80px; padding-left:10px;">Ngày y/c<label style="color:red;height:10px;">*</label>:</div>
            <div class="col-md-2" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Ngày yêu cầu" id="txtngayyeucau" name="ngayyeucau" /></div>
            
        </div>

        <div class="row" style="padding-top: 5px; padding-bottom: 1px;">
            <div class="col-md-1" style="min-width: 130px; padding-left: 10px;"></div>
            <div class="col-md-7" style="padding-left:10px;">
                <button id="btn-save" type="button" class="buttoncustom WhiteButton" name="luu" value="Lưu"><i class="retweet_save"></i> Lưu</button>
                <button id="btn-save-guimail" type="button" class="buttoncustom WhiteButton" name="luu" value="Lưu & gửi" style="width:100px"><i class="retweet_save"></i> Lưu & gửi</button>
                <a href="@Url.Action("Index", "PayStaff")" class="buttoncustom WhiteButton"><i class="retweet_trove"></i> Trở về</a>
            </div>
        </div>
    }
</div>



<div id="boxContent">
    <div style="width:100%; height:100%">
        <div class="portlet-body">
            <div class="table-responsive">
                <table class="table table-bordered table_danhSach" id="tableContent" style="font-size:12px;">
                    <thead id="head-date">
                    </thead>
                    <tbody id="head-date1"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div style="height:7px;"></div>
<div class="boxEdit">
    <div class="row">
        <div class="col-md-12" style="font-size: 14px; border-radius: 5px; font-weight: bold; color: black; padding-left: 10px; height: 28px; line-height:26px; background-color:0090d9">II. Đề xuất của phòng QTNL</div>
    </div>
    <div class="row">
        <div class="col-md-3" style="min-width: 130px; padding-left:10px;"><input type="checkbox" id="chkdieudongdiduankhac" name="chkdieudongdiduankhac" />Điều động đi dự án khác (Tất cả/theo Stt)</div>
        <div class="col-md-7" style="padding-left:10px;">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Điều động đi dự án khác (Tất cả/theo Stt) nhập theo: 1,2,3,4,5" id="txtdieudongdiduankhac" name="dieudongdiduankhac" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-3" style="min-width: 130px; padding-left:10px;"><input type="checkbox" id="chkdieudongvephongban" name="chkdieudongvephongban" />Điều động về phòng ban (Tất cả/theo Stt)</div>
        <div class="col-md-7" style="padding-left:10px;">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Điều động về phòng ban (Tất cả/theo Stt) nhập theo: 1,2,3,4,5" id="txtdieudongvephongban" name="dieudongvephongban" />
        </div>
    </div>
    <div class="row">
        <div class="col-md-3" style="min-width: 130px; padding-left:10px;"><input type="checkbox" id="chkdexuatchonghiviec" name="chkdexuatchonghiviec" />Đề xuất cho nghỉ việc (Tất cả/theo Stt)</div>
        <div class="col-md-7" style="padding-left:10px;">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Đề xuất cho nghỉ việc (Tất cả/theo Stt) nhập theo: 1,2,3,4,5" id="txtdexuatchonghiviec" name="dexuatchonghiviec" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-1" style="min-width: 180px; padding-left:10px;">Chỉ huy trưởng<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Chỉ huy trưởng" id="txttruongbophan_cht" name="truongbophan_cht" /></div>

        <div class="col-md-1" style="padding-left:10px;">Email<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Địa chỉ Email" id="txttruongbophan_cht_email" name="txttruongbophan_cht_email" /></div>
    </div>

    <div class="row">
        <div class="col-md-1" style="min-width: 180px; padding-left: 10px;">GĐDA/P.TGĐ phụ trách<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="GĐDA/P.TGĐ phụ trách" id="txtgiamdocduan_ptgd" name="giamdocduan_ptgd" /></div>

        <div class="col-md-1" style="padding-left:10px;">Email<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Địa chỉ Email" id="txtgiamdocduan_ptgd_email" name="giamdocduan_ptgd_email" /></div>
    </div>


    <div class="row">
        <div class="col-md-1" style="min-width: 180px; padding-left: 10px;">Phòng QTNNL<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Phòng QTNNL" id="txtphongqtnnl" name="phongqtnnl" /></div>

        <div class="col-md-1" style="padding-left:10px;">Email<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Địa chỉ Email" id="txtphongqtnnl_email" name="phongqtnnl_email" /></div>
    </div>

</div>


<script>

    $(document).ready(function (e) {
        renderDate();
        //renderDate_body();
        $('#txtmanvs').on('keypress', function (event) {
            debugger;
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if (keycode == '13') {
                GetData_lapdanhsachdieudong_timkiem(false);
            }
        });

        $("#filter01").chosen().change(function () {
            debugger;
            GetData(true);
        });
    });

    $('#boxContent').on('click', '.button-add', function () {
        var stt = $("#tableContent > tbody > tr").length + 1;
        var newTr = '<tr class="rows-box" matiendo=0 mabosungnhansu=0>'
            + '<td class="ovh col1"> ' + stt + ' </td>'
           + '<td class="ovh col2 boxEdit"><input type="text" id="txtvitricongtac" style="width:100%;height:24px" autocomplete="off" placeholder="" name="vitricongtac" /></th>'
            + '<td class="ovh col3 boxEdit"><input type="text" id="txtsoluong" style="width:100%;height:24px; text-align: center;" autocomplete="off" placeholder="" name="soluong" /></td>'
            + '<td class="ovh col4 boxEdit"><input type="text" id="txtchuyenmon" style="width:100%;height:24px;text-align: left;" placeholder="" name="chuyenmon" /></td>'
            + '<td class="ovh col5 boxEdit"><input type="text" id="txttrinhdo" style="width:100%;height:24px" autocomplete="off" placeholder="" name="trinhdo"/></td>'
            + '<td class="ovh col6 boxEdit"><input type="text" id="txtthoigiantiepnhan" style="width:100%;height:24px;text-align: center;" autocomplete="off" placeholder="" name="thoigiantiepnhan" /></td>'
            + '<td class="ovh col7 boxEdit"><input type="text" id="txttieuchuan_ghichu" style="width:100%;height:24px" autocomplete="off" placeholder="" name="tieuchuan_ghichu" /></td>'
            + '<td id="btnAdd" style="text-align: center;font-weight: bold;font-size: 13px;"><a href="#" class="button-add">Add</a> |&nbsp;<a href="#" class="button-del">Del</a></td></tr>';
        $('#boxContent table tbody').append(newTr);
    });

    $('#boxContent').on('click', '.button-del', function () {
        debugger;
        if ($("#tableContent > tbody > tr").length > 1) {
            $(this).closest('tr').remove();
        }
    });

    $('#btnLuudulieu-detail-nhansu').on('click', function (e) {
        debugger;
        e.preventDefault();
        if ($("#txtnguoilap_dieudong_duyet").val().trim() == "1") {
            Thongbao("Hồ sơ đã gửi chờ duyệt. Không chỉnh sữa được");
            return false;
        }
        var data = [];
        var DataJson = "{'data1':";
        DataJson += "{";

        DataJson += "'mabosungnhansu':'" + $('#txtmabosungnhansu').val() + "',";
        DataJson += "'ngaylapdanhsachdieudong':'" + $('#txtngaylapdanhsachdieudong').val() + "',";

        DataJson += "'nguoilap_dieudong':'" + $('#txtnguoilap_dieudong').val() + "',";
        DataJson += "'nguoilapemail_dieudong':'" + $('#txtnguoilapemail_dieudong').val() + "',";

        DataJson += "'bangiamdoc_dieudong':'" + $('#txtbangiamdoc_dieudong').val() + "',";
        DataJson += "'bangiamdocemail_dieudong':'" + $('#txtbangiamdocemail_dieudong').val() + "'";


        DataJson += "}, 'data2':[";

        $('#boxContent table tbody tr').each(function (index, item) {
            debugger;
            var madanhsach = encodeURIComponent($(item).attr('codeid'));
            var thongtinlienlac = $(item).attr('thongtinlienlac');
            var manhanvien = $(item).find('td.col2').attr('title');
            var hovaten = $(item).find('td.col2 input').val();
            var noilamviec_cu = $(item).find('td.col3 select').val();
            var chucdanh_cu = $(item).find('td.col4 select').val();

            var noilamviec_moi = $(item).find('td.col5 select').val();
            var chucdanh_moi = $(item).find('td.col6 select').val();

            var ngaydieudongdukien = $(item).find('td.col7 input').val();
            var ghichu = $(item).find('td.col8 input').val();
            var vungmien = $(item).find('td.col9 input').prop('checked');



            DataJson += "{";
            DataJson += "'madanhsach':'" + madanhsach + "',";
            DataJson += "'manhanvien':'" + manhanvien + "',";
            DataJson += "'hovaten':'" + hovaten + "',";
            DataJson += "'noilamviec_cu':'" + noilamviec_cu + "',";
            DataJson += "'chucdanh_cu':'" + chucdanh_cu + "',";
            DataJson += "'noilamviec_moi':'" + noilamviec_moi + "',";
            DataJson += "'chucdanh_moi':'" + chucdanh_moi + "',";
            DataJson += "'ngaydieudongdukien':'" + ngaydieudongdukien + "',";
            DataJson += "'ghichu':'" + ghichu + "',";
            DataJson += "'vungmien':'" + vungmien + "',";
            DataJson += "'thongtinlienlac':'" + thongtinlienlac + "',";
            DataJson += "}";
            if (index != $('#boxContent table tbody tr').length - 1)
                DataJson += ",";
        });

        DataJson += "]}";
        $.ajax({
            type: 'POST',
            url: '/AddStaff/Save_detail',
            datatype: "JSON",
            data: "DataJson=" + DataJson,
            cache: false,

        })
        .done(function (result) {
            debugger;
            var tb = JSON.stringify(result.success);
            if (tb == "true") {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu thành công.</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    GetData_ddns_timkiemds_saukhiluu(false);
                    dialogSuccess.modal('hide');
                }, 2000);
            } else {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu không thành công</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    dialogSuccess.modal('hide');
                }, 2000);
            }
            //alert("Done: " + JSON.stringify(result));
        })
        .fail(function (result) {
            alert("FAILED: " + JSON.stringify(result));

        });
    })



    $('#btn-save').on('click', function (e) {
        e.preventDefault();
        debugger;
        if ($("#txttenduan").val().length < 3) {
            Thongbao("Tên dự án không được bỏ trống");
            return false;
        }

        var data = [];
        var DataJson = "{'data1':";
        DataJson += "{";

        DataJson += "'matranhansu':'" + $('#txtmatranhansu').val() + "',";
        DataJson += "'mabosungnhansu':'" + $('#txtmabosungnhansu').val() + "',";

        DataJson += "'tenduan':'" + $('#txttenduan').val() + "',";
        DataJson += "'goithau':'" + $('#txtgoithau').val() + "',";
        DataJson += "'diachi':'" + $('#txtdiachi').val() + "',";
        DataJson += "'ngayyeucau':'" + $('#txtngayyeucau').val() + "',";

        if ($('#chkcongnghiep:checked').length == 1) {
            DataJson += "'congnghiep':'on',";
        }
        else {
            DataJson += "'congnghiep':'off',";
        }

        if ($('#chkthuongmai:checked').length == 1) {
            DataJson += "'thuongmai':'on',";
        }
        else {
            DataJson += "'thuongmai':'off',";
        }

        if ($('#chkdandung:checked').length == 1) {
            DataJson += "'dandung':'on',";
        }
        else {
            DataJson += "'dandung':'off',";
        }

        if ($('#chknghiduong:checked').length == 1) {
            DataJson += "'nghiduong':'on',";
        }
        else {
            DataJson += "'nghiduong':'off',";
        }

        if ($('#chkhatang:checked').length == 1) {
            DataJson += "'hatang':'on',";
        }
        else {
            DataJson += "'hatang':'off',";
        }

        DataJson += "'khac_noidung':'" + $('#txtkhac_noidung').val() + "',";

        DataJson += "'tiendovagiatrithang':'" + $('#txttiendovagiatrithang').val() + "',";
        DataJson += "'ngaykhoicong':'" + $('#txtngaykhoicong').val() + "',";
        DataJson += "'ngayhoanthanh':'" + $('#txtngayhoanthanh').val() + "',";

        DataJson += "'dieudongdiduankhac':'" + $('#txtdieudongdiduankhac').val() + "',";
        DataJson += "'dieudongvephongban':'" + $('#txtdieudongvephongban').val() + "',";
        DataJson += "'dexuatchonghiviec':'" + $('#txtdexuatchonghiviec').val() + "',";


        DataJson += "'truongbophan_cht':'" + $('#txttruongbophan_cht').val() + "',";
        DataJson += "'truongbophan_cht_email':'" + $('#txttruongbophan_cht_email').val() + "',";

        DataJson += "'giamdocduan_ptgd':'" + $('#txtgiamdocduan_ptgd').val() + "',";
        DataJson += "'giamdocduan_ptgd_email':'" + $('#txtgiamdocduan_ptgd_email').val() + "',";

        DataJson += "'phongqtnnl':'" + $('#txtphongqtnnl').val() + "',";
        DataJson += "'phongqtnnl_email':'" + $('#txtphongqtnnl_email').val() + "',";


        DataJson += "'phongban_congtruong':'1'";

        DataJson += "}, 'data2':[";

        $('#boxContent table tbody tr').each(function (index, item) {
            debugger;
            var makehoach = $(item).attr('makehoach');
            var matranhansu = $(item).attr('matranhansu');
            var vitricongtac = $(item).find('td.cols2').text();

            var soluong = $(item).find('td.cols3 input').val();
            var thoigianchuyentra = $(item).find('td.cols4 input').val();

            var soluong1 = $(item).find('td.cols5 input').val();
            var thoigianchuyentra1 = $(item).find('td.cols6 input').val();

            var soluong2 = $(item).find('td.cols7 input').val();
            var thoigianchuyentra2 = $(item).find('td.cols8 input').val();

            var ghichu = $(item).find('td.cols9 input').val();

            DataJson += "{";
            DataJson += "'makehoach':'" + makehoach + "',";
            DataJson += "'matranhansu':'" + matranhansu + "',";
            DataJson += "'vitricongtac':'" + vitricongtac + "',";
            DataJson += "'soluong':'" + soluong + "',";
            DataJson += "'thoigianchuyentra':'" + thoigianchuyentra + "',";

            DataJson += "'soluong1':'" + soluong1 + "',";
            DataJson += "'thoigianchuyentra1':'" + thoigianchuyentra1 + "',";

            DataJson += "'soluong2':'" + soluong2 + "',";
            DataJson += "'thoigianchuyentra2':'" + thoigianchuyentra2 + "',";

            DataJson += "'ghichu':'" + ghichu + "'";
            DataJson += "}";
            if (index != $('#boxContent table tbody tr').length - 1)
                DataJson += ",";
        });
        DataJson += "]}";
        $.ajax({
            type: 'POST',
            url: '/PayStaff/Save',
            datatype: "JSON",
            data: "DataJson=" + DataJson,
            cache: false,

        })
        .done(function (result) {
            debugger;
            var tb = JSON.stringify(result.success);
            var idmatranhansu = JSON.stringify(result.matranhansu);
            if (tb == "true") {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu thành công.</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    $('#txtmatranhansu').val(idmatranhansu);
                    dialogSuccess.modal('hide');
                }, 2000);
            } else {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu không thành công</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    $('#txtmatranhansu').val(0);
                    dialogSuccess.modal('hide');
                }, 2000);
            }
        })
        .fail(function (result) {
            alert("FAILED: " + JSON.stringify(result));

        });
    })

    $('#btn-save-guimail').on('click', function (e) {
        e.preventDefault();
        debugger;
        if ($("#txttenduan").val().length < 3) {
            Thongbao("Tên dự án không được bỏ trống");
            return false;
        }

        var data = [];
        var DataJson = "{'data1':";
        DataJson += "{";

        DataJson += "'matranhansu':'" + $('#txtmatranhansu').val() + "',";
        DataJson += "'mabosungnhansu':'" + $('#txtmabosungnhansu').val() + "',";

        DataJson += "'tenduan':'" + $('#txttenduan').val() + "',";
        DataJson += "'goithau':'" + $('#txtgoithau').val() + "',";
        DataJson += "'diachi':'" + $('#txtdiachi').val() + "',";
        DataJson += "'ngayyeucau':'" + $('#txtngayyeucau').val() + "',";

        DataJson += "'congnghiep':'" + $('#chkcongnghiep').val() + "',";
        DataJson += "'thuongmai':'" + $('#chkthuongmai').val() + "',";
        DataJson += "'dandung':'" + $('#chkdandung').val() + "',";
        DataJson += "'nghiduong':'" + $('#chknghiduong').val() + "',";
        DataJson += "'hatang':'" + $('#chkhatang').val() + "',";
        DataJson += "'khac_noidung':'" + $('#txtkhac_noidung').val() + "',";

        DataJson += "'tiendovagiatrithang':'" + $('#txttiendovagiatrithang').val() + "',";
        DataJson += "'ngaykhoicong':'" + $('#txtngaykhoicong').val() + "',";
        DataJson += "'ngayhoanthanh':'" + $('#txtngayhoanthanh').val() + "',";

        DataJson += "'dieudongdiduankhac':'" + $('#txtdieudongdiduankhac').val() + "',";
        DataJson += "'dieudongvephongban':'" + $('#txtdieudongvephongban').val() + "',";
        DataJson += "'dexuatchonghiviec':'" + $('#txtdexuatchonghiviec').val() + "',";


        DataJson += "'truongbophan_cht':'" + $('#txttruongbophan_cht').val() + "',";
        DataJson += "'truongbophan_cht_email':'" + $('#txttruongbophan_cht_email').val() + "',";

        DataJson += "'giamdocduan_ptgd':'" + $('#txtgiamdocduan_ptgd').val() + "',";
        DataJson += "'giamdocduan_ptgd_email':'" + $('#txtgiamdocduan_ptgd_email').val() + "',";

        DataJson += "'phongqtnnl':'" + $('#txtphongqtnnl').val() + "',";
        DataJson += "'phongqtnnl_email':'" + $('#txtphongqtnnl_email').val() + "',";


        DataJson += "'phongban_congtruong':'1'";

        DataJson += "}, 'data2':[";

        $('#boxContent table tbody tr').each(function (index, item) {
            debugger;
            var makehoach = $(item).attr('makehoach');
            var matranhansu = $(item).attr('matranhansu');
            var vitricongtac = $(item).find('td.cols2').text();

            var soluong = $(item).find('td.cols3 input').val();
            var thoigianchuyentra = $(item).find('td.cols4 input').val();

            var soluong1 = $(item).find('td.cols5 input').val();
            var thoigianchuyentra1 = $(item).find('td.cols6 input').val();

            var soluong2 = $(item).find('td.cols7 input').val();
            var thoigianchuyentra2 = $(item).find('td.cols8 input').val();

            var ghichu = $(item).find('td.cols9 input').val();

            DataJson += "{";
            DataJson += "'makehoach':'" + makehoach + "',";
            DataJson += "'matranhansu':'" + matranhansu + "',";
            DataJson += "'vitricongtac':'" + vitricongtac + "',";
            DataJson += "'soluong':'" + soluong + "',";
            DataJson += "'thoigianchuyentra':'" + thoigianchuyentra + "',";

            DataJson += "'soluong1':'" + soluong1 + "',";
            DataJson += "'thoigianchuyentra1':'" + thoigianchuyentra1 + "',";

            DataJson += "'soluong2':'" + soluong2 + "',";
            DataJson += "'thoigianchuyentra2':'" + thoigianchuyentra2 + "',";

            DataJson += "'ghichu':'" + ghichu + "'";
            DataJson += "}";
            if (index != $('#boxContent table tbody tr').length - 1)
                DataJson += ",";
        });
        DataJson += "]}";
        $.ajax({
            type: 'POST',
            url: '/PayStaff/Saveandsentmail',
            datatype: "JSON",
            data: "DataJson=" + DataJson,
            cache: false,

        })
        .done(function (result) {
            debugger;
            var tb = JSON.stringify(result.success);
            var idmatranhansu = JSON.stringify(result.matranhansu);
            if (tb == "true") {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu và gửi mail thành công.</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    $('#txtmatranhansu').val(idmatranhansu);
                    dialogSuccess.modal('hide');
                    history.back();
                }, 2000);
            } else {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu và gửi mail không thành công</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    $('#txtmatranhansu').val(0);
                    dialogSuccess.modal('hide');
                }, 2000);
            }
        })
        .fail(function (result) {
            alert("FAILED: " + JSON.stringify(result));

        });
    })

    function renderDate() {
        var html = '';
        debugger;
        html += '<tr>';
        html += '<th class="ovh col1">Stt</th>';
        html += '<th class="ovh col2">Họ và tên</th>';
        html += '<th class="ovh col3">Trình độ (ĐH, CĐ,...)</th>';
        html += '<th class="ovh col4">Chuyên môn (XD, KTS,...)</th>';
        html += '<th class="ovh col5">Vị trí công việc đang phụ trách</th>';
        html += '<th class="ovh col6">Thời gian chuyển trả</th>';
        html += '<th class="ovh col7">Lý do chuyển trả</th>';
        html += '<th class="ovh col8">Ghi chú</th>';
        html += '<th class="ovh col9"></th>';
        html += '</tr>';

        html += '<tr>';
        html += '<th class="ovh col2 boxEdit" colspan="3"><input type="text" id="txtmanvs" style="width:100%;height:24px;text-align: left;" autocomplete="off" placeholder="Nhập mã nhân viên, Họ tên, Email để tìm kiếm" name="manvs" /></th>'
             + '<th class="ovh col3" colspan="6" id="btnLuudulieu-detail-nhansu" style="text-align: left;line-height: 21px"><a href="#" class="buttoncustom WhiteButton"> Lưu</a></th>'
            + ' </tr>';

        $('#head-date').html(html);
    }

    function Thongbao(num) {
        var dialogSuccess = bootbox.dialog({
            message: "<i class='fa fa-check text-success'></i><span class='text-success'>" + num + "</span>",
            closeButton: false,
            onEscape: function () {
            }
        });
        setTimeout(function () {
            dialogSuccess.modal('hide');
        }, 1000);
    }

</script>

