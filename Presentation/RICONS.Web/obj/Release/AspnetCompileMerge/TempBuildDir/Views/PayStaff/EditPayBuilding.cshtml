@model RICONS.Web.Models.ddns_paystaffModels
@{
    ViewBag.Title = "Cập nhật nhân sự dự án";
}
@*--css--*@
@section CSS
{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~")themes/RICONS-2015/css/controller/PayStaff/NewPayBuilding.css" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~")themes/RICONS-2015/css/chosen/chosen.css" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~")themes/RICONS-2015/css/chosen/prism.css" />
}

@*--javascript--*@
@section JavaScript
{
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/controllers/PayStaff/EditPayBuilding.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/jquery-ui-1.10.0.custom.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/jquery.datepick-vi.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/chosen/chosen.jquery.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/chosen/prism.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/table/buildTable.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/colResizale/colResizable-1.3.source.js"></script>
    <script type="text/javascript" src="@Url.Content("~")Themes/RICONS-2015/css/TableBuild/global/plugins/jquery.blockui.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")Themes/RICONS-2015/css/TableBuild/global/scripts/app.min.js"></script>

    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/bootbox.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/custom.js"></script>

<script>
    $(document).ready(function (e) {
        setValueToCombobox();
    });
    function setValueToCombobox() {
        
        if (@Model.congnghiep == 1) {
            $("#chkcongnghiep").prop('checked', true);
        }
        if (@Model.thuongmai == 1) {
            $("#chkthuongmai").prop('checked', true);
        }
        if (@Model.dandung == 1) {
            $("#chkdandung").prop('checked', true);
        }
        if (@Model.nghiduong == 1) {
            $("#chknghiduong").prop('checked', true);
        }
        if (@Model.hatang == 1) {
            $("#chkhatang").prop('checked', true);
        }

    }
</script>

}
<script>
    var linkContent = '@Url.Content("~")';
</script>


<div class="HeaderFixed">
    <div class="b-b b-light">
        <div class="p-left c-black">Tạo mới thông tin nhân sự dự án @Model.tenduan &nbsp;&nbsp;&nbsp;</div>
        <div class="clearBoth"></div>
    </div>
</div>


<div class="boxEdit">
    @using (Html.BeginForm("EditPayBuilding", "PayStaff", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post))
    {
        <div class="row">
            <div class="col-md-2" style="width:170px;"></div>
            <div class="col-md-1"><label style="color:red" id="lblthongbao" class="hidden"></label></div>
            <div class="col-md-1" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" class="hidden" id="txtmatranhansu" name="matranhansu" value="@Model.matranhansu" /></div>
            <div class="col-md-1" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" class="hidden" id="txttruongbophan_cht_duyet" name="truongbophan_cht_duyet" value="@Model.truongbophan_cht_duyet" /></div>

        </div>

         <div class="row">
           <div class="col-md-1" style="min-width: 130px; padding-left: 10px;">Chọn dự án<label style="color:red;height:10px;">*</label>:</div>
           <div class="col-md-3" style="padding-left:10px;">
               <select id="filter01" data-placeholder="Tên lớp học" class="chosen-select-loaikehoach" name="mabosungnhansu">
                   @*<option value="0">Chọn dự án công trường trả nhân sự</option>*@
                   @if (!string.IsNullOrEmpty(ViewBag.sbpaystaff))
                   {
                       @Html.Raw(ViewBag.sbpaystaff);
                   }
               </select>
           </div>      
        </div>
        
        <div class="row">
            <div class="col-md-1" style="min-width: 130px; padding-left:10px;">Tên dự án<label style="color:red;height:10px;">*</label>:</div>
            <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Tên dự án" id="txttenduan" name="tenduan" value="@Model.tenduan" /></div>

            <div class="col-md-1" style="min-width: 80px; padding-left:10px;">Gói thầu<label style="color:red;height:10px;">*</label>:</div>
            <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Gói thầu" id="txtgoithau" name="goithau" value="@Model.goithau" /></div>
        </div>

        <div class="row">
            <div class="col-md-1" style="min-width: 130px; padding-left:10px;">Địa chỉ<label style="color:red;height:10px;">*</label>:</div>
            <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Địa chỉ" id="txtdiachi" name="diachi" value="@Model.diachi" /></div>

            <div class="col-md-1" style="min-width: 80px; padding-left:10px;">Ngày y/c<label style="color:red;height:10px;">*</label>:</div>
            <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Ngày yêu cầu" id="txtngayyeucau" name="ngayyeucau" value="@Model.ngayyeucau" /></div>
        </div>

        <div class="row" style="padding-top: 5px; padding-bottom: 1px;">
            <div class="col-md-1" style="min-width: 130px; padding-left: 10px;"></div>
            <div class="col-md-7" style="padding-left:10px;">
                <button id="btn-save" type="button" class="buttoncustom WhiteButton" name="luu" value="Lưu"><i class="retweet_save"></i> Lưu</button>
                <button id="btn-save-guimail" type="button" class="buttoncustom WhiteButton" name="luu" value="Lưu & gửi" style="width:100px"><i class="retweet_save"></i> Lưu & gửi</button>
                <a href="@Url.Action("Index", "PayStaff")" class="buttoncustom WhiteButton"><i class="retweet_trove"></i> Trở về</a>
            </div>
        </div>

    }
</div>

<div class="boxEdit">

    <div class="row" style="padding-left:6px">
        <div class="col-md-12" style="font-size: 14px; border-radius: 5px; font-weight: bold; color: black; padding-left: 1px; height: 28px; line-height:26px; background-color:0090d9">I. Thông tin dự án</div>
    </div>

    <div class="row" style="padding-left:12px">
        <div class="col-md-1" style="min-width: 130px;">1. Loại hình<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-5" style="width:455px;">
            <input type="checkbox" id="chkcongnghiep" name="congnghiep" />Công nghiệp &nbsp;&nbsp;
            <input type="checkbox" id="chkthuongmai" name="thuongmai" />Thương mại&nbsp;&nbsp;
            <input type="checkbox" id="chkdandung" name="dandung" />Dân dụng&nbsp;&nbsp;
            <input type="checkbox" id="chknghiduong" name="nghiduong" />Nghỉ dưỡng&nbsp;&nbsp;
            <input type="checkbox" id="chkhatang" name="hatang" />Hạ tầng
        </div>
        <div class="col-md-1" style="min-width: 80px; padding-left:10px;">Khác:</div>
        <div class="col-md-4" style="padding-left:10px;">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Khác" id="txtkhac_noidung" name="khac_noidung" value="@Model.khac_noidung" />
        </div>
    </div>

    <div class="row" style="padding-left:12px">
        <div class="col-md-1" style="min-width: 130px;">2. Tiến độ và giá trị<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-1">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Tính bằng tháng" id="txttiendovagiatrithang" name="tiendovagiatrithang" value="@Model.tiendovagiatrithang" />
        </div>
        <div class="col-md-1" style="min-width: 120px; padding-left:5px">Ngày khởi công<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-1">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Ngày khởi công" id="txtngaykhoicong" name="ngaykhoicong" value="@Model.ngaykhoicong" />
        </div>

        <div class="col-md-1" style="min-width: 120px; padding-left:5px">Ngày hoàn thành<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-1">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Ngày hoàn thành" id="txtngayhoanthanh" name="ngayhoanthanh" value="@Model.ngayhoanthanh" />
        </div>

    </div>



</div>

<div id="boxContent">
    <div class="row">
        <div class="col-md-12" style="font-size: 14px; border-radius: 5px; font-weight: bold; color: black; padding-left: 1px; height: 28px; line-height:26px; background-color:0090d9">II. Kế hoạch chuyển trả nhân sự cho dự án</div>
    </div>
    <div style="width:100%; height:100%">
        <div class="portlet-body">
            <div class="table-responsive">
                <table class="table table-bordered table_danhSach" id="tableContent" style="font-size:12px;">
                    <thead id="head-date">
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

</div>


<div class="boxEdit">
    <div class="row">
        <div class="col-md-12" style="font-size: 14px; border-radius: 5px; font-weight: bold; color: black; padding-left: 10px; height: 28px; line-height:26px; background-color:0090d9">III. Đề xuất của phòng QTNL</div>
    </div>
    <div class="row">
        <div class="col-md-3" style="min-width: 130px; padding-left:10px;"><input type="checkbox" id="chkdieudongdiduankhac" name="chkdieudongdiduankhac" />Điều động đi dự án khác (Tất cả/theo Stt)</div>
        <div class="col-md-7" style="padding-left:10px;">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Điều động đi dự án khác (Tất cả/theo Stt) nhập theo: 1,2,3,4,5" id="txtdieudongdiduankhac" name="dieudongdiduankhac" value="@Model.dieudongdiduankhac" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-3" style="min-width: 130px; padding-left:10px;"><input type="checkbox" id="chkdieudongvephongban" name="chkdieudongvephongban" />Điều động về phòng ban (Tất cả/theo Stt)</div>
        <div class="col-md-7" style="padding-left:10px;">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Điều động về phòng ban (Tất cả/theo Stt) nhập theo: 1,2,3,4,5" id="txtdieudongvephongban" name="dieudongvephongban" value="@Model.dieudongvephongban" />
        </div>
    </div>
    <div class="row">
        <div class="col-md-3" style="min-width: 130px; padding-left:10px;"><input type="checkbox" id="chkdexuatchonghiviec" name="chkdexuatchonghiviec" />Đề xuất cho nghỉ việc (Tất cả/theo Stt)</div>
        <div class="col-md-7" style="padding-left:10px;">
            <input type="text" style="width: 100%;" autocomplete="off" placeholder="Đề xuất cho nghỉ việc (Tất cả/theo Stt) nhập theo: 1,2,3,4,5" id="txtdexuatchonghiviec" name="dexuatchonghiviec" value="@Model.dexuatchonghiviec" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-1" style="min-width: 180px; padding-left:10px;">Chỉ huy trưởng<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Chỉ huy trưởng" id="txttruongbophan_cht" name="truongbophan_cht" value="@Model.truongbophan_cht" /></div>

        <div class="col-md-1" style="padding-left:10px;">Email<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Địa chỉ Email" id="txttruongbophan_cht_email" name="truongbophan_cht_email" value="@Model.truongbophan_cht_email" /></div>
    </div>

    <div class="row">
        <div class="col-md-1" style="min-width: 180px; padding-left: 10px;">GĐDA/P.TGĐ phụ trách<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="GĐDA/P.TGĐ phụ trách" id="txtgiamdocduan_ptgd" name="giamdocduan_ptgd" value="@Model.giamdocduan_ptgd" /></div>

        <div class="col-md-1" style="padding-left:10px;">Email<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Địa chỉ Email" id="txtgiamdocduan_ptgd_email" name="giamdocduan_ptgd_email" value="@Model.giamdocduan_ptgd_email" /></div>
    </div>


    <div class="row">
        <div class="col-md-1" style="min-width: 180px; padding-left: 10px;">Phòng QTNNL<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Phòng QTNNL" id="txtphongqtnnl" name="phongqtnnl" value="@Model.phongqtnnl" /></div>

        <div class="col-md-1" style="padding-left:10px;">Email<label style="color:red;height:10px;">*</label>:</div>
        <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Địa chỉ Email" id="txtphongqtnnl_email" name="phongqtnnl_email" value="@Model.phongqtnnl_email" /></div>
    </div>

</div>




<script>

    $(document).ready(function (e) {
        renderDate();
    });


    $('#btn-save').on('click', function (e) {
        e.preventDefault();
        debugger;
        if ($("#txttruongbophan_cht_duyet").val().trim() == "1") {
            Thongbao("Hồ sơ đã gửi chờ duyệt. Không chỉnh sữa được");
            return false;
        }
        else if ($("#txttenduan").val().length < 3) {
            Thongbao("Tên dự án không được bỏ trống");
            return false;
        }

        var data = [];
        var DataJson = "{'data1':";
        DataJson += "{";

        DataJson += "'matranhansu':'" + $('#txtmatranhansu').val() + "',";
        DataJson += "'mabosungnhansu':'" + $('#txtmabosungnhansu').val() + "',";

        DataJson += "'tenduan':'" + $('#txttenduan').val() + "',";
        DataJson += "'goithau':'" + $('#txtgoithau').val() + "',";
        DataJson += "'diachi':'" + $('#txtdiachi').val() + "',";
        DataJson += "'ngayyeucau':'" + $('#txtngayyeucau').val() + "',";

        if ($('#chkcongnghiep:checked').length == 1)
        {
            DataJson += "'congnghiep':'on',";
        }
        else
        {
            DataJson += "'congnghiep':'off',";
        }

        if ($('#chkthuongmai:checked').length == 1) {
            DataJson += "'thuongmai':'on',";
        }
        else {
            DataJson += "'thuongmai':'off',";
        }

        if ($('#chkdandung:checked').length == 1) {
            DataJson += "'dandung':'on',";
        }
        else {
            DataJson += "'dandung':'off',";
        }

        if ($('#chknghiduong:checked').length == 1) {
            DataJson += "'nghiduong':'on',";
        }
        else {
            DataJson += "'nghiduong':'off',";
        }

        if ($('#chkhatang:checked').length == 1) {
            DataJson += "'hatang':'on',";
        }
        else {
            DataJson += "'hatang':'off',";
        }
        DataJson += "'khac_noidung':'" + $('#txtkhac_noidung').val() + "',";

        DataJson += "'tiendovagiatrithang':'" + $('#txttiendovagiatrithang').val() + "',";
        DataJson += "'ngaykhoicong':'" + $('#txtngaykhoicong').val() + "',";
        DataJson += "'ngayhoanthanh':'" + $('#txtngayhoanthanh').val() + "',";

        DataJson += "'dieudongdiduankhac':'" + $('#txtdieudongdiduankhac').val() + "',";
        DataJson += "'dieudongvephongban':'" + $('#txtdieudongvephongban').val() + "',";
        DataJson += "'dexuatchonghiviec':'" + $('#txtdexuatchonghiviec').val() + "',";


        DataJson += "'truongbophan_cht':'" + $('#txttruongbophan_cht').val() + "',";
        DataJson += "'truongbophan_cht_email':'" + $('#txttruongbophan_cht_email').val() + "',";

        DataJson += "'giamdocduan_ptgd':'" + $('#txtgiamdocduan_ptgd').val() + "',";
        DataJson += "'giamdocduan_ptgd_email':'" + $('#txtgiamdocduan_ptgd_email').val() + "',";

        DataJson += "'phongqtnnl':'" + $('#txtphongqtnnl').val() + "',";
        DataJson += "'phongqtnnl_email':'" + $('#txtphongqtnnl_email').val() + "',";


        DataJson += "'phongban_congtruong':'1'";

        DataJson += "}, 'data2':[";

        $('#boxContent table tbody tr').each(function (index, item) {
            debugger;
            var makehoach = $(item).attr('makehoach');
            var matranhansu = $(item).attr('matranhansu');
            var vitricongtac = $(item).find('td.cols2').text();

            var soluong = $(item).find('td.cols3 input').val();
            var thoigianchuyentra = $(item).find('td.cols4 input').val();

            var soluong1 = $(item).find('td.cols5 input').val();
            var thoigianchuyentra1 = $(item).find('td.cols6 input').val();

            var soluong2 = $(item).find('td.cols7 input').val();
            var thoigianchuyentra2 = $(item).find('td.cols8 input').val();

            var ghichu = $(item).find('td.cols9 input').val();

            DataJson += "{";
            DataJson += "'makehoach':'" + makehoach + "',";
            DataJson += "'matranhansu':'" + matranhansu + "',";
            DataJson += "'vitricongtac':'" + vitricongtac + "',";
            DataJson += "'soluong':'" + soluong + "',";
            DataJson += "'thoigianchuyentra':'" + thoigianchuyentra + "',";

            DataJson += "'soluong1':'" + soluong1 + "',";
            DataJson += "'thoigianchuyentra1':'" + thoigianchuyentra1 + "',";

            DataJson += "'soluong2':'" + soluong2 + "',";
            DataJson += "'thoigianchuyentra2':'" + thoigianchuyentra2 + "',";

            DataJson += "'ghichu':'" + ghichu + "'";
            DataJson += "}";
            if (index != $('#boxContent table tbody tr').length - 1)
                DataJson += ",";
        });
        DataJson += "]}";
        $.ajax({
            type: 'POST',
            url: '/PayStaff/Save',
            datatype: "JSON",
            data: "DataJson=" + DataJson,
            cache: false,

        })
        .done(function (result) {
            debugger;
            var tb = JSON.stringify(result.success);
            var idmatranhansu = JSON.stringify(result.matranhansu);
            if (tb == "true") {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu thành công.</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    $('#txtmatranhansu').val(idmatranhansu);
                    dialogSuccess.modal('hide');
                }, 2000);
            } else {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu không thành công</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    $('#txtmatranhansu').val(0);
                    dialogSuccess.modal('hide');
                }, 2000);
            }
        })
        .fail(function (result) {
            alert("FAILED: " + JSON.stringify(result));

        });
    })

    $('#btn-save-guimail').on('click', function (e) {
        e.preventDefault();
        debugger;
        if ($("#txttruongbophan_cht_duyet").val().trim() == "1") {
            Thongbao("Hồ sơ đã gửi chờ duyệt. Không chỉnh sữa được");
            return false;
        }
        else if ($("#txttenduan").val().length < 3) {
            Thongbao("Tên dự án không được bỏ trống");
            return false;
        }

        var data = [];
        var DataJson = "{'data1':";
        DataJson += "{";

        DataJson += "'matranhansu':'" + $('#txtmatranhansu').val() + "',";
        DataJson += "'mabosungnhansu':'" + $('#txtmabosungnhansu').val() + "',";

        DataJson += "'tenduan':'" + $('#txttenduan').val() + "',";
        DataJson += "'goithau':'" + $('#txtgoithau').val() + "',";
        DataJson += "'diachi':'" + $('#txtdiachi').val() + "',";
        DataJson += "'ngayyeucau':'" + $('#txtngayyeucau').val() + "',";

        if ($('#chkcongnghiep:checked').length == 1)
        {
            DataJson += "'congnghiep':'on',";
        }
        else
        {
            DataJson += "'congnghiep':'off',";
        }

        if ($('#chkthuongmai:checked').length == 1) {
            DataJson += "'thuongmai':'on',";
        }
        else {
            DataJson += "'thuongmai':'off',";
        }

        if ($('#chkdandung:checked').length == 1) {
            DataJson += "'dandung':'on',";
        }
        else {
            DataJson += "'dandung':'off',";
        }

        if ($('#chknghiduong:checked').length == 1) {
            DataJson += "'nghiduong':'on',";
        }
        else {
            DataJson += "'nghiduong':'off',";
        }

        if ($('#chkhatang:checked').length == 1) {
            DataJson += "'hatang':'on',";
        }
        else {
            DataJson += "'hatang':'off',";
        }
        DataJson += "'khac_noidung':'" + $('#txtkhac_noidung').val() + "',";

        DataJson += "'tiendovagiatrithang':'" + $('#txttiendovagiatrithang').val() + "',";
        DataJson += "'ngaykhoicong':'" + $('#txtngaykhoicong').val() + "',";
        DataJson += "'ngayhoanthanh':'" + $('#txtngayhoanthanh').val() + "',";

        DataJson += "'dieudongdiduankhac':'" + $('#txtdieudongdiduankhac').val() + "',";
        DataJson += "'dieudongvephongban':'" + $('#txtdieudongvephongban').val() + "',";
        DataJson += "'dexuatchonghiviec':'" + $('#txtdexuatchonghiviec').val() + "',";

        DataJson += "'truongbophan_cht':'" + $('#txttruongbophan_cht').val() + "',";
        DataJson += "'truongbophan_cht_email':'" + $('#txttruongbophan_cht_email').val() + "',";

        DataJson += "'giamdocduan_ptgd':'" + $('#txtgiamdocduan_ptgd').val() + "',";
        DataJson += "'giamdocduan_ptgd_email':'" + $('#txtgiamdocduan_ptgd_email').val() + "',";

        DataJson += "'phongqtnnl':'" + $('#txtphongqtnnl').val() + "',";
        DataJson += "'phongqtnnl_email':'" + $('#txtphongqtnnl_email').val() + "',";


        DataJson += "'phongban_congtruong':'1'";

        DataJson += "}, 'data2':[";

        $('#boxContent table tbody tr').each(function (index, item) {
            debugger;
            var makehoach = $(item).attr('makehoach');
            var matranhansu = $(item).attr('matranhansu');
            var vitricongtac = $(item).find('td.cols2').text();

            var soluong = $(item).find('td.cols3 input').val();
            var thoigianchuyentra = $(item).find('td.cols4 input').val();

            var soluong1 = $(item).find('td.cols5 input').val();
            var thoigianchuyentra1 = $(item).find('td.cols6 input').val();

            var soluong2 = $(item).find('td.cols7 input').val();
            var thoigianchuyentra2 = $(item).find('td.cols8 input').val();

            var ghichu = $(item).find('td.cols9 input').val();

            DataJson += "{";
            DataJson += "'makehoach':'" + makehoach + "',";
            DataJson += "'matranhansu':'" + matranhansu + "',";
            DataJson += "'vitricongtac':'" + vitricongtac + "',";
            DataJson += "'soluong':'" + soluong + "',";
            DataJson += "'thoigianchuyentra':'" + thoigianchuyentra + "',";

            DataJson += "'soluong1':'" + soluong1 + "',";
            DataJson += "'thoigianchuyentra1':'" + thoigianchuyentra1 + "',";

            DataJson += "'soluong2':'" + soluong2 + "',";
            DataJson += "'thoigianchuyentra2':'" + thoigianchuyentra2 + "',";

            DataJson += "'ghichu':'" + ghichu + "'";
            DataJson += "}";
            if (index != $('#boxContent table tbody tr').length - 1)
                DataJson += ",";
        });
        DataJson += "]}";
        $.ajax({
            type: 'POST',
            url: '/PayStaff/Saveandsentmail',
            datatype: "JSON",
            data: "DataJson=" + DataJson,
            cache: false,

        })
        .done(function (result) {
            debugger;
            var tb = JSON.stringify(result.success);
            var idmatranhansu = JSON.stringify(result.matranhansu);
            if (tb == "true") {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu và gửi mail thành công.</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    $('#txtmatranhansu').val(idmatranhansu);
                    dialogSuccess.modal('hide');
                    history.back();
                }, 2000);
            } else {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lưu dữ liệu và gửi mail không thành công</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    $('#txtmatranhansu').val(0);
                    dialogSuccess.modal('hide');
                }, 2000);
            }
        })
        .fail(function (result) {
            alert("FAILED: " + JSON.stringify(result));

        });
    })

    function renderDate() {
        var html = '';
        debugger;
        html += '<tr>';
        html += '<th class="ovh cols1" rowspan="2">Stt</th>';
        html += '<th class="ovh cols2" rowspan="2">Vị trí công tác</th>';
        html += '<th colspan="2">Thi công phần ngầm (cọ, móng hầm)</th>';
        html += '<th colspan="2">Thi công phần thân thô</th>';
        html += '<th colspan="2">Thi công phần hoàn thiện</th>';
        html += '<th class="ovh cols9" rowspan="2" style="text-align: center;">Ghi chú</th>';
        html += '</tr>';

        html += '<tr>';
        html += '<th class="ovh cols3">Số lượng</th>';
        html += '<th class="ovh cols4">Thời gian chuyển trả</th>';
        html += '<th class="ovh cols5">Số lượng</th>';
        html += '<th class="ovh cols6">Thời gian chuyển trả</th>';
        html += '<th class="ovh cols7">Số lượng</th>';
        html += '<th class="ovh cols8">Thời gian chuyển trả</th>';
        html += '</tr>';

        $('#head-date').html(html);
    }

    function Thongbao(num) {
        var dialogSuccess = bootbox.dialog({
            message: "<i class='fa fa-check text-success'></i><span class='text-success'>" + num + "</span>",
            closeButton: false,
            onEscape: function () {
            }
        });
        setTimeout(function () {
            dialogSuccess.modal('hide');
        }, 1000);
    }

</script>



