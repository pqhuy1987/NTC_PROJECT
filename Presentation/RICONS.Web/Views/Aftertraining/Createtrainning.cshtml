@model RICONS.Web.Models.daotao_ykiensaodaotaoModels
@{
    ViewBag.Title = "Phiếu tiếp nhận ý kiến sau đào tạo";
}
@*--css--*@
@section CSS
{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~")themes/RICONS-2015/css/controller/Daotao/Createtrainning.css" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~")themes/RICONS-2015/css/chosen/chosen.css" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~")themes/RICONS-2015/css/chosen/prism.css" />
}

@*--javascript--*@
@section JavaScript
{
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/controllers/Daotao/Createtrainning.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/jquery-ui-1.10.0.custom.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/jquery.datepick-vi.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/chosen/chosen.jquery.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/chosen/prism.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/table/buildTable.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/colResizale/colResizable-1.3.source.js"></script>
    <script type="text/javascript" src="@Url.Content("~")Themes/RICONS-2015/css/TableBuild/global/plugins/jquery.blockui.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")Themes/RICONS-2015/css/TableBuild/global/scripts/app.min.js"></script>

    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/bootbox.min.js"></script>
    <script type="text/javascript" src="@Url.Content("~")themes/RICONS-2015/js/custom.js"></script>

}
<script>
    var linkContent = '@Url.Content("~")';
</script>


<div class="HeaderFixed" >
    <div class="b-b b-light" style="padding: 5px 10px;">
        <div class="p-left c-black">PHIẾU TIẾP NHẬN Ý KIẾN SAU ĐÀO TẠO</div>
        <div class="clearBoth"></div>
    </div>
</div>


<div class="boxEdit" style="padding: 0px 0px;">
    @using (Html.BeginForm("Createtrainning", "Aftertraining", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post))
    {
        <div class="row">
            <div class="col-md-2" style="width:170px;"></div>
            <div class="col-md-7"><label style="color:red" id="lblthongbao" class="hidden"></label></div>
            <input type="text" style="width: 100%;" autocomplete="off"  id="txtemail" class="hidden" name="email" />
            <input type="text" style="width: 100%;" autocomplete="off" id="txtmanv" class="hidden" name="manv" />
            <input type="text" style="width: 100%;" autocomplete="off" id="txtmatiepnhan" class="hidden" name="matiepnhan" />
        </div>

        <div>

            <div class="row" style="padding:2px">
                <div class="col-md-12" style="font-size: 14px; position: relative; border-radius: 5px; font-weight: bold; color: white; padding-left: 7px; height: 30px; background-color: #0090d9; ">THÔNG TIN CÁ NHÂN</div>
            </div>

            <div class="row">
                <div class="col-md-1" style="min-width: 130px; padding-left: 10px;">Tên lớp học<label style="color:red;height:10px;">*</label>:</div>
                <div class="col-md-7" style="padding-left:10px;">
                    <select id="filter01" data-placeholder="Tên lớp học" class="chosen-select-loaikehoach" name="malop">
                        @*<option value="0">Chọn tên lớp học</option>*@
                        @if (!string.IsNullOrEmpty(ViewBag.sblophoc))
                        {
                            @Html.Raw(ViewBag.sblophoc);
                        }
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-1" style="min-width: 130px; padding-left:10px;">Tiêu đề khóa học<label style="color:red;height:10px;">*</label>:</div>
                <div class="col-md-7" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Tiêu đề khóa học" id="txttieudekhoahoc" name="tieudekhoahoc" /></div>
            </div>

            <div class="row">
                <div class="col-md-1" style="min-width: 130px; padding-left:10px;">Tên học viên<label style="color:red;height:10px;">*</label>:</div>
                <div class="col-md-2" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Tên học viên" id="txthovaten" name="hovaten" /></div>

                <div class="col-md-2" style="padding-left:10px;">Phòng ban/Công trường<label style="color:red;height:10px;">*</label>:</div>
                <div class="col-md-3" style="padding-left:10px;">
                    <select id="filter02" data-placeholder="Phòng ban/Công trường" class="chosen-select-maphongban" name="maphongban">
                        <option value="0">Chọn Phòng ban/Công trường</option>
                        @if (!string.IsNullOrEmpty(ViewBag.sbphongban))
                        {
                            @Html.Raw(ViewBag.sbphongban);
                        }
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-1" style="min-width: 130px; padding-left:10px;">Giảng viên<label style="color:red;height:10px;">*</label>:</div>
                <div class="col-md-2" style="padding-left:10px;"><input type="text" style="width: 100%;" autocomplete="off" placeholder="Giảng viên" id="txttengiaovien" name="tengiaovien" /></div>

                <div class="col-md-2" style="padding-left:10px;">Ngày đào tạo<label style="color:red;height:10px;">*</label>:</div>
                <div class="col-md-3" style="padding-left:10px;"><input type="text" style="width:100%" autocomplete="off" placeholder="Ngày đào tạo" id="txtngaydaotao" name="ngaydaotao" /></div>
            </div>

            <div class="row" style="padding-top: 5px; padding-bottom: 4px;">
                <div class="col-md-1" style="min-width: 130px; padding-left: 10px;"></div>
                <div class="col-md-7" style="padding-left:10px;">
                    <button id="btn-save" type="button" class="buttoncustom WhiteButton" style="width: 120px;" name="luu" value="Lưu"><i class="retweet_save"></i> Gửi đánh giá</button>
                    @*<a href="@Url.Action("Index", "Classlist")" class="buttoncustom WhiteButton"><i class="retweet_trove"></i> Trở về</a>*@
                </div>
            </div>

        </div>
    }
</div>


<div style="width:100%; overflow-x: scroll;">
    <div id="boxContent">
        <div style="width:100%; height:100%">
            <div class="portlet-body">
                <div class="table-responsive">
                    <table class="table table-bordered table_danhSach" id="tableContent" style="font-size:14px;">
                        <thead id="head-date">
                        </thead>
                        <tbody>
                           
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>



<script>

    $(document).ready(function (e) {
        renderDate();
    });

    $('#btn-save').on('click', function (e) {
        e.preventDefault();
        if ($("#filter01").val() == "0") {
            Thongbao("Chọn lớp đào tạo đánh giá");
            return false;
        }
        
        var data = [];
        var DataJson = "{'data1':";
        DataJson += "{";
        DataJson += "'matiepnhan':'" + $('#txtmatiepnhan').val() + "',";
        DataJson += "'malop':'" + $('#filter01').val() + "',";
        DataJson += "'manv':'" + $('#txtmanv').val() + "',";
        DataJson += "'email':'" + $('#txtemail').val() + "',";
        DataJson += "'hovaten':'" + $('#txthovaten').val() + "',";
        DataJson += "'maphongban':'" + $('#filter02').val() + "',";
        DataJson += "'tieudekhoahoc':'" + $('#txttieudekhoahoc').val() + "',";
        DataJson += "'tengiaovien':'" + $('#txttengiaovien').val() + "',";
        DataJson += "'ngaydaotao':'" + $('#txtngaydaotao').val() + "'";
        DataJson += "}, 'data2':[";

        $('#boxContent table tbody tr').each(function (index, item) {

            var matiepnhan_tieuchidaotao = encodeURIComponent($(item).attr('codeid'));
            var matieuchi = encodeURIComponent($(item).attr('matieuchi'));
            var matiepnhan = encodeURIComponent($(item).attr('matiepnhan'));
            var danhmuccha = encodeURIComponent($(item).attr('danhmuccha'));
            var danhmucgoc = encodeURIComponent($(item).attr('danhmucgoc'));

            debugger;

            //var tentieuchi = $(item).find('td.col2').attr('value');

            var tentieuchi = $(item).find('td.col1').text();


            var kem = $(item).find('td.col2 input').prop('checked');
            var trungbinh = $(item).find('td.col3 input').prop('checked');
            var kha = $(item).find('td.col4 input').prop('checked');
            var tot = $(item).find('td.col5 input').prop('checked');
            var rattot = $(item).find('td.col6 input').prop('checked');

            //$("#chknhanvien").prop('checked', true);

            DataJson += "{";
            DataJson += "'matiepnhan_tieuchidaotao':'" + matiepnhan_tieuchidaotao + "',";
            DataJson += "'matieuchi':'" + matieuchi + "',";
            DataJson += "'matiepnhan':'" + matiepnhan + "',";
            DataJson += "'danhmuccha':'" + danhmuccha + "',";
            DataJson += "'danhmucgoc':'" + danhmucgoc + "',";

            DataJson += "'tentieuchi':'" + tentieuchi + "',";
            DataJson += "'kem':'" + kem + "',";
            DataJson += "'trungbinh':'" + trungbinh + "',";
            DataJson += "'kha':'" + kha + "',";
            DataJson += "'tot':'" + tot + "',";
            DataJson += "'rattot':'" + rattot + "'";

            DataJson += "}";
            if (index != $('#boxContent table tbody tr').length - 1)
                DataJson += ",";
        });
        DataJson += "]}";

        $.ajax({
            type: 'POST',
            url: '/Aftertraining/Save',
            datatype: "JSON",
            data: "DataJson=" + DataJson,
            cache: false,

        })
        .done(function (result) {
            debugger;
            var tb = JSON.stringify(result.success);
            if (tb == "true") {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Cảm ơn bạn đã đóng góp ý kiến.</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    dialogSuccess.modal('hide');
                    GetData(true);
                }, 2000);
            } else {
                var dialogSuccess = bootbox.dialog({
                    message: "<i class='fa fa-check text-success'></i><span class='text-success'>Lỗi lưu dữ liệu. Vui lòng đánh giá lại</span>",
                    closeButton: false,
                    onEscape: function () {
                    }
                });
                setTimeout(function () {
                    dialogSuccess.modal('hide');
                }, 2000);
            }
        })
        .fail(function (result) {
            alert("FAILED: " + JSON.stringify(result));

        });
    })


    function renderDate() {

        var html = '';
        html += '<tr>';
        html += '<th class="ovh col1">Tiêu chí đánh giá</th>';
        html += '<th class="ovh col2">Kém</th>';
        html += '<th class="ovh col3">Trung Bình</th>';
        html += '<th class="ovh col4">Khá</th>';
        html += '<th class="ovh col5">Tốt</th>';
        html += '<th class="ovh col6">Rất tốt</th>';

        html += '</tr>';
        $('#head-date').html(html);
    }

    function Thongbao(num) {
        var dialogSuccess = bootbox.dialog({
            message: "<i class='fa fa-check text-success'></i><span class='text-success'>" + num + "</span>",
            closeButton: false,
            onEscape: function () {
            }
        });
        setTimeout(function () {
            dialogSuccess.modal('hide');
        }, 1000);
    }

</script>






